# Chrome Extension ê°œë°œ ë¬¸ì„œ (Extension)

ì´ ë¬¸ì„œëŠ” Live Stream Translator í”„ë¡œì íŠ¸ì˜ **Chrome Extension ê°œë°œ ì „ìš© ê¸°ìˆ  ë¬¸ì„œ**ì…ë‹ˆë‹¤.
Manifest V3 ê¸°ë°˜ìœ¼ë¡œ ì˜¤ë””ì˜¤ ìº¡ì²˜ â†’ STT â†’ ë²ˆì—­ â†’ ìë§‰ í‘œì‹œê¹Œì§€ì˜ ì „ì²´ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ ë°©ë²•ì„ í¬í•¨í•©ë‹ˆë‹¤.

---

# ğŸ“Œ 1. ê°œìš”

Chrome Extensionì€ ì „ì²´ ì‚¬ìš©ì ì¤‘ **90%**ê°€ ì‚¬ìš©í•  í•µì‹¬ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.
ì‹œìŠ¤í…œ ì „ì²´ êµ¬ì¡° ì¤‘ ë‹¤ìŒ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤:

* íƒ­ ì˜¤ë””ì˜¤ ìº¡ì²˜ (chrome.tabCapture)
* ì‹¤ì‹œê°„ STT (Web Speech API ë˜ëŠ” Cloud STT)
* ë²ˆì—­ API ì—°ë™ (Papago/DeepL/Google)
* ìë§‰ UI Overlay í‘œì‹œ
* ìºì‹± ë° ì„¤ì • ê´€ë¦¬
* Desktop Appê³¼ì˜ ì„ íƒì  ì—°ë™

---

# ğŸ“ 2. í”„ë¡œì íŠ¸ êµ¬ì¡° (Extension)

```
extension/
â”œâ”€â”€ manifest.json
â”œâ”€â”€ background.js (Service Worker)
â”œâ”€â”€ content.js (ë©”ì¸ ë¡œì§)
â”œâ”€â”€ offscreen.html / offscreen.js
â”œâ”€â”€ popup.html / popup.js (ì„¤ì • UI)
â”œâ”€â”€ overlay.css
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ platform.js      (í”Œë«í¼ ê°ì§€)
â”‚   â”œâ”€â”€ stt.js           (STT ì—”ì§„)
â”‚   â”œâ”€â”€ translator.js    (ë²ˆì—­ ì—”ì§„)
â”‚   â””â”€â”€ cache.js         (ìºì‹œ)
â””â”€â”€ icons/
```

---

# ğŸ”§ 3. Manifest V3 ì„¤ì •

### ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•  ê¶Œí•œ

```json
{
  "permissions": [
    "storage",
    "activeTab",
    "scripting",
    "offscreen"
  ],
  "host_permissions": [
    "https://www.youtube.com/*",
    "https://www.twitch.tv/*",
    "https://chzzk.naver.com/*",
    "https://www.sooplive.co.kr/*",
    "https://www.nicovideo.jp/*"
  ]
}
```

### tabCapture ê¶Œí•œ

```json
"permissions": ["tabCapture"]
```

### background ì„¤ì •

```json
"background": {
  "service_worker": "background.js"
}
```

### content scripts

```json
"content_scripts": [
  {
    "matches": ["<all_urls>"],
    "js": ["content.js"],
    "css": ["overlay.css"]
  }
]
```

### offscreen ë¬¸ì„œ (í•„ìˆ˜)

Manifest V3ëŠ” ì˜¤ë””ì˜¤ ìº¡ì²˜ë¥¼ ì§ë ¬ë¡œ ì²˜ë¦¬í•˜ê¸° ì–´ë µê¸° ë•Œë¬¸ì— offscreen ë¬¸ì„œê°€ í•„ìš”í•¨.

```json
"offscreen_documents": [
  {
    "matches": ["*://*/offscreen.html"],
    "js": ["offscreen.js"]
  }
]
```

---

# ğŸ§  4. í”Œë«í¼ ê°ì§€ ì‹œìŠ¤í…œ (platform.js)

í”Œë«í¼ ê°ì§€ëŠ” ì•„ë˜ 3ê°€ì§€ ê¸°ì¤€ìœ¼ë¡œ ì´ë£¨ì–´ì§:

## 4-1. URL íŒ¨í„´

```js
if (location.host.includes("youtube.com")) return "youtube";
```

## 4-2. DOM êµ¬ì¡° ì²´í¬

```js
if (document.querySelector(".ytp-live-badge")) isLive = true;
```

## 4-3. UI ìœ„ì¹˜/ìŠ¤íƒ€ì¼ ì„¤ì •

```js
const PLATFORM_CONFIG = {
  youtube: { bottom: 100 },
  twitch: { bottom: 80 },
  soop: { bottom: 120 }
};
```

---

# ğŸ”Š 5. íƒ­ ì˜¤ë””ì˜¤ ìº¡ì²˜ (tabCapture)

### capture ìš”ì²­ (background.js)

```js
chrome.action.onClicked.addListener(async (tab) => {
  const stream = await chrome.tabCapture.capture({
    audio: true,
    video: false
  });

  chrome.tabs.sendMessage(tab.id, {
    type: "AUDIO_STREAM",
    streamId: stream.id
  });
});
```

### AudioContextë¡œ ìŒì†Œê±° ë°©ì§€

```js
const audioContext = new AudioContext();
const source = audioContext.createMediaStreamSource(stream);
source.connect(audioContext.destination); // ìŒì†Œê±° ë°©ì§€ í•µì‹¬
```

---

# ğŸ—£ï¸ 6. ìŒì„± ì¸ì‹ (STT) â€“ Web Speech API

### ê¸°ë³¸ ì„¤ì •

```js
const recognition = new webkitSpeechRecognition();
recognition.continuous = true;
recognition.interimResults = true;
recognition.lang = "ja-JP";
```

### ê²°ê³¼ ì²˜ë¦¬

```js
recognition.onresult = (event) => {
  const result = event.results[event.results.length - 1];
  const text = result[0].transcript;
  const isFinal = result.isFinal;
};
```

### ìë™ ì¬ì‹œì‘

```js
recognition.onend = () => {
  setTimeout(() => recognition.start(), 300);
};
```

---

# ğŸŒ 7. ë²ˆì—­ ì—”ì§„ (translator.js)

### Papago API í˜¸ì¶œ ì˜ˆì‹œ

```js
async function papagoTranslate(text) {
  const res = await fetch("https://openapi.naver.com/v1/papago/n2mt", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded",
      "X-Naver-Client-Id": NAVER_ID,
      "X-Naver-Client-Secret": NAVER_SECRET
    },
    body: `source=ja&target=ko&text=${encodeURIComponent(text)}`
  });
  const data = await res.json();
  return data.message.result.translatedText;
}
```

### ë²ˆì—­ ìºì‹± (LRU)

```js
const cache = new Map();
function setCache(key, value) {
  if (cache.size > 100) cache.delete(cache.keys().next().value);
  cache.set(key, value);
}
```

---

# ğŸ–¼ï¸ 8. ìë§‰ UI Overlay

### DOM ìƒì„± (content.js)

```js
const overlay = document.createElement("div");
overlay.id = "lst-overlay";
document.body.appendChild(overlay);
```

### CSS (overlay.css)

```css
#lst-overlay {
  position: fixed;
  bottom: 100px;
  width: 100%;
  text-align: center;
  color: white;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(6px);
  font-size: 22px;
  z-index: 999999;
  pointer-events: none;
}
```

---

# âš ï¸ 9. ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

### STT ì˜¤ë¥˜

* network ì˜¤ë¥˜ â†’ ìë™ ì¬ì‹œì‘
* no-speech â†’ ë¬´ì‹œ í›„ ì¬ì‹œì‘

### ë²ˆì—­ ì˜¤ë¥˜

* Papago ì‹¤íŒ¨ â†’ Googleë¡œ fallback
* HTTP 429 â†’ ëŒ€ê¸° í›„ ì¬ì‹œì‘

### ì˜¤ë””ì˜¤ ìº¡ì²˜ ì˜¤ë¥˜

* ê¶Œí•œ ê±°ë¶€ â†’ íŒì—…ì—ì„œ ê²½ê³  í‘œì‹œ

---

# ğŸ“¦ 10. ì„¤ì • ì €ì¥ (chrome.storage)

### ì˜ˆì‹œ

```js
chrome.storage.sync.set({ targetLang: "ko" });
chrome.storage.sync.get(["targetLang"], console.log);
```

---

# ğŸ§ª 11. í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

* YouTube Live í…ŒìŠ¤íŠ¸ ì˜ìƒ
* Twitch ìŠ¤íŠ¸ë¦¬ë¨¸ í…ŒìŠ¤íŠ¸ ì±„ë„

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

* CPU ì‚¬ìš©ë¥  < 10%
* ë©”ëª¨ë¦¬ < 50MB

### ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸

* Chrome
* Edge

---

# ğŸ§© 12. Chrome Web Store ë°°í¬

í•„ìˆ˜ ì¤€ë¹„ë¬¼:

* ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨
* ìŠ¤í¬ë¦°ìƒ· 5ê°œ
* ë™ì˜ìƒ ë°ëª¨(ì„ íƒ)
* ì¹´í…Œê³ ë¦¬: Productivity

ì‹¬ì‚¬ ì£¼ì˜ì‚¬í•­:

* ê³¼í•œ ê¶Œí•œ ìš”ì²­ ê¸ˆì§€
* API Key ë…¸ì¶œ ê¸ˆì§€
* ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì§‘ ê¸ˆì§€

---

# ğŸ“˜ ê²°ë¡ 

ì´ ë¬¸ì„œëŠ” Chrome Extension ê°œë°œì— í•„ìš”í•œ **ê¸°ìˆ ì  ì •ë³´ë§Œ ë¶„ë¦¬**í•˜ì—¬ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.
ì˜¤ë””ì˜¤ ìº¡ì²˜ â†’ STT â†’ ë²ˆì—­ â†’ UIì˜ ì „ì²´ íë¦„ì„ Extension ë‹¨ë…ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.